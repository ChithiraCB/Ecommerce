{% load static %}
{% load social_share %}
{% include 'includes/detailsheader.html' %}

{% block content %}
<main>
    <section class="product-card">
        <div class="product-image">
            <img src="{{ rental_products.image.url }}" alt="{{ rental_products.rental_product_name }}">
        </div>
        
        <div class="product-details">
            <h1>{{ rental_products.rental_product_name }}</h1>
            <div class="price-options-container"> <!-- Container for rental price and options -->
                <p class="product-price">
                    <span class="sale-price" id="rent-price">Rent price : Rs.{{ rental_products.rental_price }}</span>
                </p>

                <div class="rent-duration">
                    <input type="radio" id="4-days" name="rent-duration" value="4">
                    <label for="4-days">4 Days</label>
                    
                    <input type="radio" id="8-days" name="rent-duration" value="8">
                    <label for="8-days">8 Days</label>
                </div>

                <p class="refund-amount">(+ Refundable security amount)</p> <!-- Refundable security amount inside price-options-container -->
            </div>
            <p class="product-description">Product Description: {{ rental_products.description }}</p>

           

            <div class="event-date-container">
                <label for="event-date">Select rental start Date:</label>
                <input type="date" id="event-date" name="event-date" value="{% now 'Y-m-d' %}">
            </div>
            
            <p>Rental End Date: <span id="end-date"></span></p>
            
            <form id="rental-form" method="post" action="{% url 'rentaladd_to_cart' rental_products.id %}">
                {% csrf_token %}
                <div class="button-container">
                    <button type="submit" id="addToCartBtn" class="btn btn-success">Add to cart</button>
                </div>
            </form>
        </div>       
    </section>
</main>

<style>
    .price-options-container {
        background-color: #fce6ec; /* Pale pink color */
        padding: 10px;
        width:50%;
        border-radius: 5px;
        margin-top:20px;
        margin-left:25%;
        margin-bottom: 20px; /* Add margin between the container and other elements */
        position: relative; /* Add position relative to contain the absolute positioned refund-amount */
    }

    .refund-amount {
        position: absolute;
        bottom: -10px; /* Adjusted to move the text slightly lower */
        right: 0;
        font-size: 9px;
        color: #999; /* Color for the text */
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var rentPriceSpan = document.getElementById('rent-price');
        var rentalPrice = parseInt("{{ rental_products.rental_price }}");

        document.querySelectorAll('input[name="rent-duration"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                if (this.value === '8') {
                    rentPriceSpan.textContent = 'Rent price : Rs.' + (rentalPrice * 1.4).toFixed(2); // Increase rental price by 40%
                } else {
                    rentPriceSpan.textContent = 'Rent price : Rs.' + rentalPrice;
                }
            });
        });

        document.getElementById('rental-form').addEventListener('submit', function(event) {
            var selectedDuration = document.querySelector('input[name="rent-duration"]:checked');
            if (!selectedDuration) {
                alert("Please select a rental duration (4 days or 8 days) before adding to cart.");
                event.preventDefault(); // Prevent form submission if no duration is selected
            }
        });
    });
    
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById('event-date').addEventListener('change', function() {
            updateEndDate();
        });
    
        document.querySelectorAll('input[name="rent-duration"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                updateEndDate();
            });
        });
    
        function updateEndDate() {
    var startDate = new Date(document.getElementById('event-date').value);
    var duration = parseInt(document.querySelector('input[name="rent-duration"]:checked').value);
    var endDate = new Date(startDate.getTime() + duration * 24 * 60 * 60 * 1000);
    
    // Format the date as DD-MM-YYYY
    var dd = String(endDate.getDate()).padStart(2, '0');
    var mm = String(endDate.getMonth() + 1).padStart(2, '0'); // January is 0!
    var yyyy = endDate.getFullYear();
    
    var endDateString = dd + '-' + mm + '-' + yyyy;
    
    document.getElementById('end-date').textContent = endDateString;
}

    });
</script>

{% endblock %}
